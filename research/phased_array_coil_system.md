# 相控阵线圈系统 - 无线功率传输
## Phased Array Coil System for Wireless Power Transfer

---

## 一、系统概念 (System Concept)

### 1.1 基本思想

使用多个发射线圈组成的阵列，通过控制每个线圈的**相位**（phase），可以**定向控制电磁场的传播方向**，实现**波束成形（Beamforming）**和**方向性功率传输**。

```
传统单线圈系统：              相控阵多线圈系统：
┌─────────┐                  ┌──────┐ ┌──────┐ ┌──────┐
│   线圈   │                  │线圈1 │ │线圈2 │ │线圈3 │
│   (全向) │                  │相位0°│ │相位φ │ │相位2φ│
└─────────┘                  └──────┘ └──────┘ └──────┘
     ↓                              ↓   ↓   ↓
   全方向                       可控方向
```

### 1.2 核心优势

1. **方向可控**：通过相位调整，将功率集中传输到特定方向
2. **效率提升**：减少功率浪费，提高传输效率
3. **跟踪能力**：实时调整相位，跟踪鼠标位置
4. **灵活性**：可以同时向多个方向传输功率（如果有多只鼠标）

---

## 二、波长与频率关系 (Wavelength and Frequency)

### 2.1 基本公式

**自由空间波长**：
```
λ = c / f
```

其中：
- **λ** (lambda) = 波长 (m)
- **c** = 光速 = 3 × 10⁸ m/s
- **f** = 频率 (Hz)

### 2.2 不同频率的波长计算

| 频率 | 波长 (λ) | 半波长 (λ/2) | 四分之一波长 (λ/4) | 适用场景 |
|------|---------|-------------|------------------|---------|
| **100 kHz** | 3000 m | 1500 m | 750 m | 近场感应，不需要波长相距 |
| **1 MHz** | 300 m | 150 m | 75 m | 近场感应 |
| **6.78 MHz** | 44.2 m | 22.1 m | 11.1 m | AirFuel/Rezence标准 |
| **13.56 MHz** | 22.1 m | 11.1 m | 5.5 m | NFC标准频率 |
| **27.12 MHz** | 11.1 m | 5.5 m | 2.8 m | ISM频段，可用于无线充电 |

### 2.3 近场 vs 远场

**近场（Near Field）** - 距离 << λ/2π：
- 主要能量存储在磁场中
- 场强度随距离³衰减（1/r³）
- **适用于：谐振感应耦合**
- 线圈间距：通常为线圈直径的10-50%，**不需要按波长间距**

**远场（Far Field）** - 距离 >> λ/2π：
- 能量以电磁波形式辐射
- 场强度随距离²衰减（1/r²）
- **适用于：RF功率传输**
- 线圈/天线间距：**通常为 λ/2 或 λ/4**

**过渡区域**：
- 0.1-1米距离对于1-30MHz频率：处于近场和远场过渡区域
- **混合特性**：既有近场感应，也有辐射特性

---

## 三、相控阵线圈设计 (Phased Array Coil Design)

### 3.1 线圈间距选择

#### 近场系统（kHz-MHz范围）
```
典型间距 = λ/4 到 λ/2
```

**示例计算（13.56 MHz）**：
- 波长 λ = 22.1 m
- **λ/4 = 5.5 m** （太远，不适合桌面应用）
- **λ/2 = 11.1 m** （太远）

**实际方案**：
- 对于**近场感应耦合**，线圈间距通常为：
  - **5-20 cm**（取决于线圈尺寸）
  - 不需要严格按波长，而是根据**磁场耦合**优化

#### 远场系统（更高频率，如2.4 GHz）
```
线圈间距 = λ/2 = c/(2f) = 3×10⁸/(2×2.4×10⁹) ≈ 6.25 cm
```

### 3.2 线圈阵列布局

#### 线性阵列（1D）
```
  [线圈1]  ←→  d  ←→  [线圈2]  ←→  d  ←→  [线圈3]  ←→  d  ←→  [线圈4]
相位: φ₀              φ₁              φ₂              φ₃
```

#### 平面阵列（2D）- 推荐用于鼠标充电
```
     [1]  [2]  [3]
     [4]  [5]  [6]    ← 可集成在鼠标垫或桌面基站
     [7]  [8]  [9]
```

**典型配置**：
- **3×3 阵列**：9个线圈（简单控制）
- **4×4 阵列**：16个线圈（更好方向控制）
- **间距**：5-15 cm（根据工作频率和线圈尺寸）

### 3.3 线圈规格设计

**单个线圈参数**：
- **直径**：3-10 cm（根据功率需求）
- **匝数**：5-20 匝
- **电感**：5-50 µH（与谐振频率匹配）
- **线材**：Litz线（多股线）降低高频损耗

---

## 四、相位控制原理 (Phase Control Principle)

### 4.1 波束成形数学原理

**电场叠加原理**：
```
E_total(x,y,z) = Σ E_n × exp(j × (k·r_n + φ_n))
```

其中：
- **E_n** = 第n个线圈产生的电场
- **k** = 波矢量 (2π/λ)
- **r_n** = 从第n个线圈到目标点的位置矢量
- **φ_n** = 第n个线圈的相位

**目标位置的方向矢量**：
```
θ_target = arctan(y_target / x_target)
```

**相位差计算**（线性阵列）：
```
Δφ = (2π × d × sin(θ)) / λ
```

其中：
- **d** = 线圈间距
- **θ** = 目标方向角度
- **λ** = 工作波长

### 4.2 相位控制算法

**步骤1：检测鼠标位置**
- 方法：磁场感应、RF信标、或相机视觉
- 输出：鼠标坐标 (x, y) 相对于阵列中心

**步骤2：计算目标方向**
```
θ = arctan(y / x)        (目标角度)
d_target = √(x² + y²)    (目标距离)
```

**步骤3：计算各线圈相位**
对于线性阵列（X方向）：
```
φ_n = (2π × n × d × sin(θ)) / λ + φ₀
```

对于平面阵列（X-Y方向）：
```
φ_mn = (2π/λ) × (m×d_x × sin(θ) + n×d_y × cos(θ)) + φ₀
```

**步骤4：相位调整**
- 通过**可变相位移相器**或**数字控制**调整每个线圈的驱动相位

### 4.3 相位控制实现

#### 方法1：数字相位控制（推荐）
```
主控MCU → 多路DDS (Direct Digital Synthesis) → 功率放大器 → 线圈
            (相位可调正弦波生成)
```

**组件**：
- **DDS芯片**：AD9833, AD9837（多路）
- **功率放大器**：Class D或E类放大器
- **MCU**：STM32F407或其他高性能MCU

#### 方法2：模拟移相器
```
信号源 → 可变移相器 → 功率放大器 → 线圈
         (模拟控制)
```

#### 方法3：数字延迟线
```
时钟 → 可编程延迟芯片 → 功率放大器 → 线圈
      (数字延迟控制相位)
```

---

## 五、电磁场监测 (Electromagnetic Field Monitoring)

### 5.1 监测目的

1. **功率分布监测**：确认功率是否集中在目标方向
2. **效率优化**：实时调整相位，最大化接收功率
3. **安全监测**：确保辐射功率在安全限值内
4. **干扰检测**：监测环境中的电磁干扰

### 5.2 监测方法

#### 方法1：磁场探头（Magnetic Field Probe）

**硬件**：
- **小线圈探头**：直径1-2 cm，多匝线圈
- **感应电压**：V = -N × dΦ/dt
- **位置**：在目标位置附近，或移动扫描

**测量内容**：
- 磁场强度 H (A/m)
- 磁感应强度 B (Tesla)

```
B = μ₀ × H
```

**探头布置**：
```
发射阵列平面：
┌────────────────────────────┐
│   [线圈阵列]                │
│                             │
│        ↑                    │
│    [磁场探头]               │
│    (可移动扫描)              │
└────────────────────────────┘
```

#### 方法2：接收端反馈（Recommended for Mouse Application）

**原理**：鼠标接收线圈反馈接收功率信息

```
鼠标接收端 → 测量接收功率 → 通过蓝牙反馈 → 发射端调整相位
```

**优势**：
- **闭环控制**：直接优化实际接收功率
- **实时优化**：不断调整相位，追踪最大功率点

**实现**：
```c
// 伪代码示例
while(1) {
    measured_power = read_received_power();
    if (measured_power < previous_power) {
        // 尝试微调相位
        adjust_phase_direction(-delta);
    } else {
        adjust_phase_direction(+delta);
    }
    previous_power = measured_power;
    delay(10ms);
}
```

#### 方法3：电场探头（Electric Field Probe）

**硬件**：
- **偶极子天线**或**小尺寸探头**
- 测量电场强度 E (V/m)

**应用**：主要用于远场监测

#### 方法4：近场扫描系统

**设备**：
- **3D磁场扫描仪**（商用或自制）
- **机械移动平台**（X-Y-Z）
- **数据采集系统**

**扫描流程**：
```
1. 固定相位配置
2. 移动探头到网格点 (x, y, z)
3. 记录磁场强度
4. 生成3D磁场分布图
```

### 5.3 实时监测系统设计

**硬件架构**：
```
┌─────────────────────────────────────────┐
│         发射端（桌面基站）                │
│                                          │
│  主控MCU (STM32F407)                     │
│    │                                     │
│    ├─→ 多路DDS (相位控制)                │
│    ├─→ 功率放大器                        │
│    ├─→ 线圈阵列 (3×3或4×4)               │
│    │                                     │
│    └─→ 磁场监测探头（可选）               │
│                                          │
└─────────────────────────────────────────┘
                    ↓
              (电磁场传输)
                    ↓
┌─────────────────────────────────────────┐
│         接收端（鼠标）                    │
│                                          │
│  接收线圈 → 整流电路 → 功率测量          │
│      │                                   │
│      └─→ 通过蓝牙反馈功率信息            │
│                                          │
└─────────────────────────────────────────┘
```

**软件流程**：
```
1. 初始化：设定初始相位配置
2. 检测：获取鼠标位置（通过磁场/RF/视觉）
3. 计算：计算目标方向所需相位
4. 设置：调整各线圈相位
5. 监测：读取接收端反馈的功率
6. 优化：微调相位，搜索最大功率点
7. 循环：重复步骤2-6
```

---

## 六、实现细节 (Implementation Details)

### 6.1 工作频率选择

**推荐频率范围**：
- **6.78 MHz**（AirFuel标准）
- **13.56 MHz**（NFC标准，ISM频段）
- **27.12 MHz**（ISM频段）

**考虑因素**：
- **较低频率（100kHz-1MHz）**：近场感应，不需要波长相距，但相位控制效果有限
- **中等频率（6-30MHz）**：平衡近场和远场特性，适合相控阵
- **高频率（>100MHz）**：更明显的方向性，但需要精确的波长间距

### 6.2 线圈间距设计实例

**场景：13.56 MHz工作频率，0.1-1米传输距离**

- **波长**：λ = 22.1 m
- **过渡距离**：r_transition = λ/(2π) ≈ 3.5 m
- **工作距离0.1-1m < 3.5m**：属于**近场区域**

**近场线圈间距**：
- **不按波长**：间距设为线圈直径的20-50%
- **典型间距**：**5-15 cm**（假设线圈直径10-20cm）
- **相位差仍然有效**：虽然不遵循远场公式，但相位控制仍可优化磁场分布

**优化方法**：
- 通过**实验测量**确定最佳间距
- 使用**仿真软件**（如COMSOL, ANSYS）优化

### 6.3 相位控制精度

**相位分辨率**：
- **目标**：1-5度相位步进
- **实现**：12-bit DDS可提供0.088度分辨率
- **实际需求**：5-10度精度通常足够

**相位稳定性**：
- **温度补偿**：温度变化会影响相位
- **频率稳定性**：需要稳定的时钟源

### 6.4 功率分配

**均匀功率分配**：
```
P_total = N × P_coil
```

**功率分配控制**（可选）：
- 不同线圈可以分配不同功率
- 中心线圈功率较大，边缘线圈功率较小
- 可以进一步优化方向性

---

## 七、系统架构示例 (System Architecture Example)

### 7.1 发射端架构

```
┌─────────────────────────────────────────────────┐
│           桌面基站（发射端）                       │
│                                                  │
│  ┌──────────────────────────────────────────┐  │
│  │  主控MCU (STM32F407)                      │  │
│  │    │                                       │  │
│  │    ├─ 鼠标位置检测（PSD/相机/磁场）         │  │
│  │    ├─ 相位计算算法                          │  │
│  │    └─ 控制接口                              │  │
│  └──────────────────────────────────────────┘  │
│              │                                   │
│              ↓                                   │
│  ┌──────────────────────────────────────────┐  │
│  │  多路DDS相位生成器 (9路，3×3阵列)          │  │
│  │  DDS1: 相位 φ₁                              │  │
│  │  DDS2: 相位 φ₂                              │  │
│  │  ...                                       │  │
│  │  DDS9: 相位 φ₉                              │  │
│  └──────────────────────────────────────────┘  │
│              │                                   │
│              ↓                                   │
│  ┌──────────────────────────────────────────┐  │
│  │  功率放大器阵列 (9路)                      │  │
│  │  PA1 ~ PA9                                 │  │
│  └──────────────────────────────────────────┘  │
│              │                                   │
│              ↓                                   │
│  ┌──────────────────────────────────────────┐  │
│  │  线圈阵列 (3×3, 间距10cm)                 │  │
│  │  [1] [2] [3]                              │  │
│  │  [4] [5] [6]                              │  │
│  │  [7] [8] [9]                              │  │
│  └──────────────────────────────────────────┘  │
│                                                  │
└─────────────────────────────────────────────────┘
```

### 7.2 接收端架构

```
┌─────────────────────────────────────────────────┐
│           鼠标（接收端）                          │
│                                                  │
│  ┌──────────────────────────────────────────┐  │
│  │  接收线圈 (集成在鼠标顶部)                  │  │
│  │  尺寸: 8mm × 6mm                          │  │
│  └──────────────────────────────────────────┘  │
│              │                                   │
│              ↓                                   │
│  ┌──────────────────────────────────────────┐  │
│  │  谐振电容 + 整流电路                       │  │
│  └──────────────────────────────────────────┘  │
│              │                                   │
│              ↓                                   │
│  ┌──────────────────────────────────────────┐  │
│  │  功率测量电路                             │  │
│  │  ADC读取电压/电流                          │  │
│  └──────────────────────────────────────────┘  │
│              │                                   │
│              ↓                                   │
│  ┌──────────────────────────────────────────┐  │
│  │  nRF52840 (主控)                          │  │
│  │  - 读取功率数据                            │  │
│  │  - 通过蓝牙反馈给发射端                     │  │
│  └──────────────────────────────────────────┘  │
│                                                  │
└─────────────────────────────────────────────────┘
```

### 7.3 控制流程

```
开始
  │
  ├─→ 初始化系统
  │     ├─ 初始化线圈阵列
  │     ├─ 初始化DDS相位生成器
  │     └─ 初始化位置检测系统
  │
  ├─→ [主循环]
  │     │
  │     ├─→ 检测鼠标位置 (x, y)
  │     │
  │     ├─→ 计算目标方向角度 θ
  │     │     θ = arctan(y / x)
  │     │
  │     ├─→ 计算各线圈所需相位
  │     │     φ_n = (2π/λ) × n × d × sin(θ)
  │     │
  │     ├─→ 设置DDS相位值
  │     │
  │     ├─→ 读取接收端反馈功率
  │     │     (通过蓝牙)
  │     │
  │     ├─→ [优化循环]
  │     │     ├─→ 微调相位 (±Δφ)
  │     │     ├─→ 测量新功率
  │     │     └─→ 如果功率增加，继续；否则反向
  │     │
  │     └─→ 重复主循环
  │
  └─→ 结束
```

---

## 八、仿真与优化 (Simulation and Optimization)

### 8.1 仿真工具

**电磁场仿真**：
- **COMSOL Multiphysics**：3D电磁场仿真
- **ANSYS HFSS**：高频电磁场仿真
- **FEKO**：电磁场分析
- **开源**：**OpenEMS** (FDTD方法)

**电路仿真**：
- **LTspice**：谐振电路、功率放大器仿真
- **ADS (Advanced Design System)**：RF电路设计

### 8.2 优化目标

1. **传输效率最大化**
2. **方向性最优**（功率集中在目标方向）
3. **旁瓣抑制**（减少非目标方向的辐射）
4. **功率密度均匀**（在目标区域）

### 8.3 测量验证

**磁场测量设备**：
- **近场探头**：小型磁场探头
- **磁场扫描仪**：自动扫描测量
- **频谱分析仪**：频率分析
- **功率计**：接收功率测量

---

## 九、优势与挑战 (Advantages and Challenges)

### 9.1 优势

1. **方向可控**：功率集中在目标方向，提高效率
2. **跟踪能力**：可以实时跟踪鼠标位置
3. **多设备支持**：理论上可同时向多个方向传输
4. **减少干扰**：方向性传输减少对其他设备的干扰
5. **效率提升**：相比全向传输，可提高20-50%效率

### 9.2 挑战

1. **系统复杂度**：多路相位控制，硬件和软件复杂
2. **成本较高**：多个线圈、DDS、功率放大器
3. **校准需求**：需要精确校准相位和位置
4. **实时性要求**：需要快速响应鼠标移动
5. **磁场耦合**：线圈之间的相互耦合会影响相位控制

### 9.3 解决方案

**降低复杂度**：
- 使用**数字控制方案**（MCU + DDS），简化硬件
- **软件优化算法**，快速收敛到最优相位

**降低成本**：
- 减少线圈数量（如4×4减少到3×3）
- 使用集成的多通道DDS芯片

**提高精度**：
- **闭环反馈**：接收端反馈，实时优化
- **机器学习**：学习最优相位配置

---

## 十、频率选择建议 (Frequency Selection Recommendations)

### 10.1 针对鼠标供电应用（0.1-1米距离）

**推荐频率：13.56 MHz**

**理由**：
- ✅ **ISM频段**：无需特殊许可
- ✅ **成熟技术**：NFC广泛应用，器件成熟
- ✅ **平衡性能**：近场和远场特性平衡
- ✅ **波长**：22.1m，工作距离0.1-1m在近场，线圈间距按实际优化（5-15cm）

**其他选项**：
- **6.78 MHz**：AirFuel标准，波长44.2m，近场特性更强
- **27.12 MHz**：ISM频段，波长11.1m，方向性更好但复杂度更高

### 10.2 线圈间距计算示例（13.56 MHz）

**近场应用**（不考虑严格波长间距）：
- **线圈直径**：10 cm
- **推荐间距**：5-15 cm（线圈直径的50-150%）
- **阵列尺寸**：3×3阵列，总尺寸约30-45 cm

**相位差计算**（假设间距10cm）：
```
对于目标方向θ=30°：
Δφ = (2π × 0.1m × sin(30°)) / 22.1m
   = (2π × 0.1 × 0.5) / 22.1
   ≈ 0.0142 弧度 ≈ 0.81 度
```

**注**：虽然近场不完全遵循远场公式，但相位控制仍可优化磁场分布。

---

## 十一、参考资料 (References)

1. **相控阵天线理论**：
   - "Phased Array Antennas" by Robert J. Mailloux
   - "Array and Phased Array Antenna Basics" by Hubregt J. Visser

2. **无线功率传输**：
   - "Wireless Power Transfer" - MIT OpenCourseWare
   - IEEE Transactions on Power Electronics - WPT专题

3. **电磁场仿真**：
   - COMSOL Multiphysics Documentation
   - ANSYS HFSS User Guide

4. **硬件实现**：
   - AD9833/AD9837 DDS芯片数据手册
   - STM32F407 MCU参考手册

---

## 十二、总结 (Summary)

相控阵线圈系统通过控制多个线圈的相位，可以实现**方向性无线功率传输**。对于鼠标供电应用：

- **频率选择**：13.56 MHz（ISM频段，成熟技术）
- **线圈间距**：5-15 cm（近场应用，不严格按波长）
- **阵列规模**：3×3或4×4（平衡复杂度和性能）
- **相位控制**：数字DDS方案，5-10度精度
- **监测方法**：接收端反馈（闭环控制）+ 可选磁场探头
- **优势**：方向可控，效率提升，可跟踪移动设备
- **挑战**：系统复杂，成本较高，需要优化算法

这种方案可以作为激光方案的有效补充，特别是在需要穿透非金属障碍物的场景下。

---

*文档创建日期：2025年*
*项目：无线鼠标相控阵功率传输系统*

